{
  "StackName": "",
  "TemplateBody": "{\"AWSTemplateFormatVersion\": \"2010-09-09\", \"Resources\": {\"WillowAppECR\": {\"Type\": \"AWS::ECR::Repository\", \"Properties\": {\"repositoryName\": \"willow\"}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"6a120fc1-2439-44fd-8613-6598df97466d\"}}}, \"WillowECSLaunchConfiguration\": {\"Type\": \"AWS::AutoScaling::LaunchConfiguration\", \"Properties\": {\"UserData\": \"IyEvYmluL2Jhc2gKZWNobyAiRUNTX0NMVVNURVI9d2lsbG93IiA+PiAvZXRjL2Vjcy9lY3MuY29uZmln\", \"InstanceMonitoring\": {\"Enabled\": true}, \"ImageId\": \"ami-ff15039b\", \"KeyName\": \"willow-ecs\", \"BlockDeviceMappings\": [{\"DeviceName\": \"/dev/xvda\", \"Ebs\": {\"SnapshotId\": \"snap-03798fceb166952d0\", \"DeleteOnTermination\": true, \"VolumeType\": \"gp2\", \"VolumeSize\": 8}}, {\"DeviceName\": \"/dev/xvdcz\", \"Ebs\": {\"Encrypted\": false, \"DeleteOnTermination\": true, \"VolumeType\": \"gp2\", \"VolumeSize\": 30}}], \"EbsOptimized\": false, \"SecurityGroups\": [{\"Ref\": \"PublicHttpHttpsSshSecurityGroup\"}], \"LaunchConfigurationName\": \"willow-ecs\", \"IamInstanceProfile\": {\"Ref\": \"ecsInstanceProfile\"}, \"InstanceType\": \"t2.medium\"}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"7929cb6c-9d2a-49a6-b026-cf1460f6a6f8\"}}}, \"WillowService\": {\"Type\": \"AWS::ECS::Service\", \"Properties\": {\"Cluster\": {\"Ref\": \"WillowClusterECS\"}, \"TaskDefinition\": {\"Ref\": \"WillowTaskDef\"}, \"DesiredCount\": 1}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"f7d6bbe1-042d-4db7-b2cc-f84cc3a7bb73\"}}}, \"WillowECSGroup\": {\"Type\": \"AWS::AutoScaling::AutoScalingGroup\", \"Properties\": {\"AvailabilityZones\": [\"eu-west-2a\", \"eu-west-2b\"], \"DesiredCapacity\": 1, \"Tags\": [], \"EnabledMetrics\": [{\"Metric\": \"GroupStandbyInstances\", \"Granularity\": \"1Minute\"}, {\"Metric\": \"GroupInServiceInstances\", \"Granularity\": \"1Minute\"}, {\"Metric\": \"GroupTerminatingInstances\", \"Granularity\": \"1Minute\"}, {\"Metric\": \"GroupTotalInstances\", \"Granularity\": \"1Minute\"}, {\"Metric\": \"GroupMaxSize\", \"Granularity\": \"1Minute\"}, {\"Metric\": \"GroupMinSize\", \"Granularity\": \"1Minute\"}, {\"Metric\": \"GroupPendingInstances\", \"Granularity\": \"1Minute\"}, {\"Metric\": \"GroupDesiredCapacity\", \"Granularity\": \"1Minute\"}], \"LaunchConfigurationName\": {\"Ref\": \"WillowECSLaunchConfiguration\"}, \"AutoScalingGroupName\": \"Willow ECS Group\", \"DefaultCooldown\": 300, \"MinSize\": 1, \"MaxSize\": 1, \"VPCZoneIdentifier\": \"subnet-7aeef802,subnet-b22115f8\", \"TerminationPolicies\": [\"Default\"], \"HealthCheckGracePeriod\": 120, \"HealthCheckType\": \"EC2\", \"NewInstancesProtectedFromScaleIn\": false}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"7268dfc7-b1b4-44b5-b530-d67400efecbe\"}}}, \"WillowClusterECS\": {\"Type\": \"AWS::ECS::Cluster\", \"Properties\": {\"ClusterName\": \"willow\"}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"276785cf-01f3-4dda-897d-658d37e69f34\"}}}, \"WillowTaskDef\": {\"Type\": \"AWS::ECS::TaskDefinition\", \"Properties\": {\"volumes\": [{\"host\": {\"sourcePath\": \"solr_home\"}, \"name\": \"Solr_Home\"}, {\"host\": {\"sourcePath\": \"redis_data\"}, \"name\": \"Redis_Data\"}, {\"host\": {\"sourcePath\": \"derivatives\"}, \"name\": \"Derivatives\"}, {\"host\": {\"sourcePath\": \"fcrepo4_home\"}, \"name\": \"Fcrepo4_Home\"}, {\"host\": {\"sourcePath\": \"fcrepo4_data\"}, \"name\": \"Fcrepo4_Data\"}], \"containerDefinitions\": [{\"memoryReservation\": 500, \"mountPoints\": [{\"sourceVolume\": \"Fcrepo4_Home\", \"containerPath\": \"/fcrepo4_home/\"}, {\"sourceVolume\": \"Fcrepo4_Data\", \"containerPath\": \"/fcrepo4_data/\"}], \"name\": \"fedora\", \"image\": \"835219480274.dkr.ecr.eu-west-2.amazonaws.com/willow-fedora:latest\", \"environment\": [{\"name\": \"POSTGRES_USER\", \"value\": \"postgres\"}, {\"name\": \"POSTGRES_PASSWORD\", \"value\": \"password\"}, {\"name\": \"SECRET_KEY_BASE_TEST\", \"value\": \"sample_test_key\"}, {\"name\": \"WILLOW_EMAIL\", \"value\": \"willow@cottagelabs.com\"}, {\"name\": \"WILLOW_PASSWORD\", \"value\": \"sample_willow_pass\"}, {\"name\": \"WILLOW_NAME\", \"value\": \"Willow (Admin)\"}, {\"name\": \"WILLOW_EXPOSED_PORT\", \"value\": \"80\"}, {\"name\": \"GEOBLACKLIGHT_EXPOSED_PORT\", \"value\": \"81\"}], \"essential\": true}, {\"memoryReservation\": 250, \"mountPoints\": [{\"sourceVolume\": \"Redis_Data\", \"containerPath\": \"/data\"}], \"image\": \"835219480274.dkr.ecr.eu-west-2.amazonaws.com/willow-redis:latest\", \"essential\": true, \"name\": \"redis\"}, {\"memoryReservation\": 250, \"mountPoints\": [{\"sourceVolume\": \"Solr_Home\", \"containerPath\": \"/solr_home\"}], \"image\": \"835219480274.dkr.ecr.eu-west-2.amazonaws.com/willow-solr:latest\", \"essential\": true, \"name\": \"solr\"}, {\"memoryReservation\": 500, \"mountPoints\": [{\"sourceVolume\": \"Derivatives\", \"containerPath\": \"/derivatives\"}], \"name\": \"willow\", \"links\": [\"redis\", \"solr\", \"fedora\"], \"image\": \"835219480274.dkr.ecr.eu-west-2.amazonaws.com/willow:latest\", \"environment\": [{\"name\": \"POSTGRES_USER\", \"value\": \"postgres\"}, {\"name\": \"POSTGRES_PASSWORD\", \"value\": \"password\"}, {\"name\": \"SECRET_KEY_BASE_TEST\", \"value\": \"sample_test_key\"}, {\"name\": \"WILLOW_EMAIL\", \"value\": \"willow@cottagelabs.com\"}, {\"name\": \"WILLOW_PASSWORD\", \"value\": \"sample_willow_pass\"}, {\"name\": \"WILLOW_NAME\", \"value\": \"Willow (Admin)\"}, {\"name\": \"WILLOW_EXPOSED_PORT\", \"value\": \"80\"}, {\"name\": \"GEOBLACKLIGHT_EXPOSED_PORT\", \"value\": \"81\"}, {\"name\": \"SECRET_KEY_BASE_PRODUCTION\", \"value\": \"sample_prod_key\"}, {\"name\": \"WILLOW_SEED\", \"value\": \"false\"}, {\"name\": \"GEOBLACKLIGHT_SEED\", \"value\": \"false\"}, {\"name\": \"RAILS_SERVE_STATIC_FILES\", \"value\": \"true\"}, {\"name\": \"MESSAGE_STREAM\", \"value\": \"false\"}, {\"name\": \"MESSAGE_STREAM_NAME\", \"value\": \"willow-message-stream\"}, {\"name\": \"MESSAGE_STREAM_SHARD_COUNT\", \"value\": \"1\"}, {\"name\": \"MESSAGE_STREAM_PARTITION_KEY\", \"value\": \"willow\"}, {\"name\": \"MESSAGE_STREAM_REGION\", \"value\": \"eu-west-2\"}], \"portMappings\": [{\"containerPort\": 3000, \"hostPort\": 80}], \"essential\": true}], \"family\": \"willow\"}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"0829b4b2-b003-4517-81bb-b1d3e39372a9\"}}}, \"WillowSolrECR\": {\"Type\": \"AWS::ECR::Repository\", \"Properties\": {\"repositoryName\": \"willow-solr\"}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"35ce2b69-aef1-4c70-a6b4-1d5b34c1b921\"}}}, \"ecsInstanceRole\": {\"Type\": \"AWS::IAM::Role\", \"Properties\": {\"RoleName\": \"ecsInstanceRole\", \"Path\": \"/\", \"Description\": \"Allows EC2 instances to call AWS services on your behalf.\", \"AssumeRolePolicyDocument\": {\"Version\": \"2012-10-17\", \"Statement\": [{\"Action\": \"sts:AssumeRole\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"ec2.amazonaws.com\"}}]}}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"fb2c858c-e463-4480-aa05-9481612ace19\"}}}, \"PublicHttpHttpsSshSecurityGroup\": {\"Type\": \"AWS::EC2::SecurityGroup\", \"Properties\": {\"IpPermissionsEgress\": [{\"IpProtocol\": \"-1\", \"Ipv6Ranges\": [], \"IpRanges\": [{\"CidrIp\": \"0.0.0.0/0\"}], \"UserIdGroupPairs\": [], \"PrefixListIds\": []}], \"Description\": \"Public access to ports 22, 80 and 443\", \"IpPermissions\": [{\"PrefixListIds\": [], \"FromPort\": 80, \"IpRanges\": [{\"CidrIp\": \"0.0.0.0/0\"}], \"ToPort\": 80, \"IpProtocol\": \"tcp\", \"UserIdGroupPairs\": [], \"Ipv6Ranges\": [{\"CidrIpv6\": \"::/0\"}]}, {\"PrefixListIds\": [], \"FromPort\": 22, \"IpRanges\": [{\"CidrIp\": \"0.0.0.0/0\"}], \"ToPort\": 22, \"IpProtocol\": \"tcp\", \"UserIdGroupPairs\": [], \"Ipv6Ranges\": [{\"CidrIpv6\": \"::/0\"}]}, {\"PrefixListIds\": [], \"FromPort\": 443, \"IpRanges\": [{\"CidrIp\": \"0.0.0.0/0\"}], \"ToPort\": 443, \"IpProtocol\": \"tcp\", \"UserIdGroupPairs\": [], \"Ipv6Ranges\": [{\"CidrIpv6\": \"::/0\"}]}], \"GroupName\": \"Public ssh, http, https\", \"VpcId\": \"vpc-925bb2fb\", \"OwnerId\": \"835219480274\", \"GroupId\": \"sg-8c9321e5\"}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"5d7a7708-1753-41c0-816b-dbb841fd98ff\"}}}, \"WillowRedisECR\": {\"Type\": \"AWS::ECR::Repository\", \"Properties\": {\"repositoryName\": \"willow-redis\"}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"3d3a5af3-1816-4690-83fc-83291ca5d36b\"}}}, \"WillowFedoraECR\": {\"Type\": \"AWS::ECR::Repository\", \"Properties\": {\"repositoryName\": \"willow-fedora\"}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"30eaa50f-c52f-47d5-9e81-0596683e6d48\"}}}, \"ecsInstanceProfile\": {\"Type\": \"AWS::IAM::InstanceProfile\", \"Properties\": {\"Path\": \"/\", \"InstanceProfileName\": \"ecsInstanceProfile\", \"Roles\": [{\"Ref\": \"ecsInstanceRole\"}]}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"id\": \"c4ac9e67-759d-4b1f-a090-fab10046d8f9\"}}}}, \"Metadata\": {\"AWS::CloudFormation::Designer\": {\"3d3a5af3-1816-4690-83fc-83291ca5d36b\": {\"embeds\": [], \"position\": {\"y\": 230, \"x\": 240}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"1742a533-6646-452e-af93-c43ed9fa8257\": {\"source\": {\"id\": \"f7d6bbe1-042d-4db7-b2cc-f84cc3a7bb73\"}, \"z\": 1, \"target\": {\"id\": \"276785cf-01f3-4dda-897d-658d37e69f34\"}}, \"f7d6bbe1-042d-4db7-b2cc-f84cc3a7bb73\": {\"embeds\": [], \"position\": {\"y\": 190, \"x\": 450}, \"z\": 1, \"references\": [\"0829b4b2-b003-4517-81bb-b1d3e39372a9\", \"276785cf-01f3-4dda-897d-658d37e69f34\"], \"size\": {\"width\": 60, \"height\": 60}}, \"c4ac9e67-759d-4b1f-a090-fab10046d8f9\": {\"embeds\": [], \"position\": {\"y\": 250, \"x\": 970}, \"isassociatedwith\": [\"fb2c858c-e463-4480-aa05-9481612ace19\"], \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"0829b4b2-b003-4517-81bb-b1d3e39372a9\": {\"embeds\": [], \"position\": {\"y\": 90, \"x\": 450}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"fb2c858c-e463-4480-aa05-9481612ace19\": {\"embeds\": [], \"position\": {\"y\": 300, \"x\": 840}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"7268dfc7-b1b4-44b5-b530-d67400efecbe\": {\"embeds\": [], \"position\": {\"y\": 110, \"x\": 840}, \"isassociatedwith\": [\"7929cb6c-9d2a-49a6-b026-cf1460f6a6f8\"], \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"f16ccdbc-9e13-498c-aa60-d96a5a290d82\": {\"source\": {\"id\": \"f7d6bbe1-042d-4db7-b2cc-f84cc3a7bb73\"}, \"z\": 13, \"target\": {\"id\": \"0829b4b2-b003-4517-81bb-b1d3e39372a9\"}}, \"30eaa50f-c52f-47d5-9e81-0596683e6d48\": {\"embeds\": [], \"position\": {\"y\": 160, \"x\": 310}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"35ce2b69-aef1-4c70-a6b4-1d5b34c1b921\": {\"embeds\": [], \"position\": {\"y\": 230, \"x\": 310}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"ed15b8ca-df8e-4a24-b41c-4cc0ae3f50ab\": {\"embeds\": [], \"position\": {\"y\": 172, \"x\": 216}, \"z\": 0, \"size\": {\"width\": 60, \"height\": 60}}, \"5d7a7708-1753-41c0-816b-dbb841fd98ff\": {\"embeds\": [], \"position\": {\"y\": 210, \"x\": 720}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"7929cb6c-9d2a-49a6-b026-cf1460f6a6f8\": {\"embeds\": [], \"isrelatedto\": [\"c4ac9e67-759d-4b1f-a090-fab10046d8f9\"], \"ismemberof\": [\"5d7a7708-1753-41c0-816b-dbb841fd98ff\"], \"position\": {\"y\": 210, \"x\": 840}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"13e68dcb-eab9-4959-bc26-df5da3ba06ee\": {\"embeds\": [], \"position\": {\"y\": 160, \"x\": 240}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"6a120fc1-2439-44fd-8613-6598df97466d\": {\"embeds\": [], \"position\": {\"y\": 90, \"x\": 240}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"ca2f1ebe-ca63-492c-b132-f4374f96caf5\": {\"source\": {\"id\": \"7268dfc7-b1b4-44b5-b530-d67400efecbe\"}, \"z\": 11, \"target\": {\"id\": \"7929cb6c-9d2a-49a6-b026-cf1460f6a6f8\"}}, \"14efb56a-84d8-4fc0-8358-54ccce20618f\": {\"embeds\": [], \"position\": {\"y\": 90, \"x\": 310}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}, \"9c963997-f2b5-4b2a-ae30-731566a1b749\": {\"position\": {\"y\": 213.66666287183773, \"x\": 417.16666193803167}, \"z\": 0, \"size\": {\"width\": 60, \"height\": 60}}, \"276785cf-01f3-4dda-897d-658d37e69f34\": {\"embeds\": [], \"position\": {\"y\": 190, \"x\": 550}, \"z\": 1, \"size\": {\"width\": 60, \"height\": 60}}}}}",
  "Parameters": [],
  "DisableRollback": false,
  "TimeoutInMinutes": 0,
  "NotificationARNs": [
    ""
  ],
  "Capabilities": [
    ""
  ],
  "ResourceTypes": [
    ""
  ],
  "RoleARN": "",
  "OnFailure": "",
  "StackPolicyBody": "",
  "StackPolicyURL": "",
  "Tags": [
    {
      "Key": "",
      "Value": ""
    }
  ],
  "ClientRequestToken": ""
}